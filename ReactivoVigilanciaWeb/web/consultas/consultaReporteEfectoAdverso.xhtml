<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="../template/mainMenuTemplate.xhtml">
    <ui:define name="content"> 
        <p:idleMonitor timeout="1800000">
            <p:ajax event="idle" listener="#{crearReporteManagedBean.cerrarSesion}"/>
        </p:idleMonitor>
        <!-- **************************************************************************************************** -->        
        <!-- **************************************************************************************************** -->        
            <p:dialog modal="true" widgetVar="statusDialogConsulta" header="Procesando registros de ReactivoVigilancia" draggable="false" closable="false" resizable="false" width="300" height="300" style="alignment-adjust:middle">
                 <br/>
                 <br/>
                 <br/>
                 <center>
                 <p:graphicImage id="animacionBusqueda" value="/resources/images/procesando.gif" alt="Procesando registros de ReactivoVigilancia" title="Procesando registros de ReactivoVigilancia"/>
                     <br/>
                 <p:clock pattern="HH:mm:ss dd.MM.yyyy" mode="server" />
                 </center>
                 <br/>
                 <br/>
             </p:dialog>        
        <!-- **************************************************************************************************** -->        
        <!-- **************************************************************************************************** -->        
            <script language="JavaScript" type="text/JavaScript">
                        //**************************************************************************
                        //**************************************************************************
                        function start() 
                        {
                                    console.log ("arrancando animacion");
                                    PF('statusDialogConsulta').show();
                        }
                        //**************************************************************************
                        //**************************************************************************
                        function stop() 
                        {
                                   PF('statusDialogConsulta').hide();
                                   console.log ("Deteniendo animacion");
                        }
                        //**************************************************************************
                        //**************************************************************************
                        function validarFechasConsulta()
                        {
                                        console.log ("Entre al script");
                                        console.log ("************************************************************");
                                        console.log ("************************************************************");
                                        if (PF('fechaInWV').getDate() === null || PF('fechaFinWV').getDate() === null)
                                        {
                                            alert ("Debe ingresar el rango de fechas inicial y final del reporte solicitado");
                                            return (false);
                                        }
                                        else
                                        {
                                           start();
                                           return (true);
                                        }
                        }                        
            </script>
        <!-- **************************************************************************************************** -->        
        <!-- **************************************************************************************************** -->        
        <div align="center">
            <h:form  onkeypress="if (event.keyCode === 13) { return false; }"   id="fmrReportesEventoAdverso">
            <!-- ******************************************************** -->
            <!-- ******************************************************** -->
            <!-- ******************************************************** -->
            <!-- ******************************************************** -->
            <center>
                <center>
                    <p:outputLabel value="CONSULTA DE REPORTES DE EVENTO ADVERSO" style="font-weight: bold;font-size: 12px;"/>
                </center>
                <br/>
                <br/>
                <p:panelGrid columns="2" style="width:1200px" id="displayCrear">
		  <f:facet name="header">
		    <p:graphicImage url="/resources/images/logo-invima.png" style="border:none;" id="logoInvimaCrear" alt="Invima"/>
                  </f:facet>
                  <p:outputLabel value="Fecha Inicial:" for="fechaInicial" />
                  <p:calendar locale="es"  id  ="fechaInicial" value="#{beanReporteEventoAdverso.fechaInicial}" showOn="button" pattern="yyyy/MM/dd" widgetVar="fechaInWV"/>  
                  <p:outputLabel value="Fecha Final" for="fechaFinal" />
                  <p:calendar locale="es"  id  ="fechaFinal" value="#{beanReporteEventoAdverso.fechaFinal}" showOn="button" pattern="yyyy/MM/dd" widgetVar="fechaFinWV"/>  
                </p:panelGrid>
                <br/>
                <center>
                  <p:commandButton id="botonGenerar" value="Generar Reporte" style="vinculoSinDiv"  
                    action="#{beanReporteEventoAdverso.generarReporte}" ajax="true"
                    update="datosReporte" process="@this" 
                    onstart="return validarFechasConsulta()" oncomplete="stop()"/>
                  &nbsp;&nbsp;&nbsp;&nbsp;
                  <p:commandButton id="botonLimpiar" value="Limpiar Campos" style="vinculoSinDiv"  
                    action="#{beanReporteEventoAdverso.limpiarCampos}" ajax="true"
                    onclick="concentrarFocoFechas();"
                    process="@this" 
                    update="fechaInicial,fechaFinal,datosReporte"/>
                </center>
                        <br/>
                        <br/>
                            <p:dataTable emptyMessage="Sin registros encontrados" id="datosReporte" var="filaReporte" 
                                         value="#{beanReporteEventoAdverso.listadoReportesEventoAdverso}" style="width:4200px"
                                         paginator="true" rows="20" sortMode="multiple"  styleClass="estilo_tabla" resizableColumns="true" 
                                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="10,20,30,40,50,60,70,80,90,100">
                                <f:facet name="header">
                                    Consulta de Reportes de Evento Adverso
                                </f:facet>
                                <p:column headerText="REPORTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.reporte}" id="reporteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="DESCRIPCIÓN EFECTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.descrip_efecto}" id="descrip_efectoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="FECHA INGRESO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.fecha_ingreso}" id="fecha_ingresoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="FECHA EVENTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.fech_evento}" id="fech_eventoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="EFECTO INDESEADO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.efecto_indeseado}" id="efecto_indeseadoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="FECHA REPORTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.fech_reporte}" id="fech_reporteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="COD. PROBLEMA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.cdg_problema}" id="cdg_problemaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CLASIFICACIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.clasificacion}" id="clasificacionT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="INSTITUCIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.institucion}" id="institucionT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="IDENTIFICACIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.identificacion}" id="identificacionT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="DIRECCIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.direccion}" id="direccionT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NATURALEZA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.naturaleza}" id="naturalezaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="COMPLEJIDAD" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.complejidad}" id="complejidadT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="COD. DEPARTAMENTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.cod_depart}" id="cod_departT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="COD. MUNICIPIO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.cod_mun}" id="cod_munT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="EMAIL" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.email}" id="emailT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="TELÉFONO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.telefono}" id="telefonoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NOMBRE PACIENTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.nombre_paciente}" id="nombre_pacienteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="TIP. IDENTIFICACIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.tipidentifi}" id="tipidentifiT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="IDENTIFICACIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.identifi}" id="identifiT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="EDAD" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.edad}" id="edadT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="EDAD EN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.edad_en}" id="edad_enT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="GÉNERO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.genero}" id="generoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="DIRECCIÓN PACIENTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.direcc_paciente}" id="direcc_pacienteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="TELÉFONO PACIENTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.telefo_paciente}" id="telefo_pacienteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NOMBRE REACTIVO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.nombre_reactivo}" id="nombre_reactivoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NO. REGISTRO SANITARIO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.nroregsan}" id="nroregsanT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="FECHA VENCIMIENTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.fecha_venci}" id="fecha_venciT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="LOTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.lote}" id="loteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="PROCEDENCIA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.procedencia}" id="procedenciaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CADENA FRÍO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.cadena_frio}" id="cadena_frioT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="TEMPERATURA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.temperatura}" id="temperaturaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CERTIFICADO ANÁLISIS" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.certi_analisis}" id="certi_analisisT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="DISTRIBUCIÓN USUARIO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.distri_usuario}" id="distri_usuarioT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CONDICIONES ALMACENAMIENTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.condici_almacen}" id="condici_almacenT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="ÁREA FUNCIONAMIENTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.area_funciona}" id="area_funcionaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="OTRA ÁREA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.otra_area}" id="otra_areaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="SE DETECTO CAUSA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.causa_efecto}" id="causa_efectoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CAUSA PROBABLE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.causa_probable}" id="causa_probableT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NOTIFICÓ IMPORTADOR" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.notifico_importador}" id="notifico_importadorT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NOTIFICÓ FABRICANTE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.notifico_fabricante}" id="notifico_fabricanteT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NOTIFICÓ COMERCIALIZADOR" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.notifico_comercializador}" id="notifico_comercializadorT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="NOTIFICÓ DISTRIBUIDOR" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.notifico_distribuidor}" id="notifico_distribuidorT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="FECHA DE NOTIFICACIÓN" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.fechaNotificacion}" id="fechaNotificacionT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="SE ENVÍO A DISTRIBUIDOR" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.enviadoDistImportador}" id="enviadoDistImportadorT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="TIENE PROGRAMA DE GESTIÓN DE RIESGOS" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.gestionRiesgo}" id="gestionRiesgoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="SE REALIZÓ ANÁLISIS" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.analisisEfecto}" id="analisisEfectoT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="HERRAMIENTA DE ANÁLISIS" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.herramientaAnalisis}" id="herramientaAnalisisT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="OTRA HERRAMIENTA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.otra_herramienta}" id="otra_herramientaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CAUSAS O FACTORES" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.descripcionCausa}" id="descripcionCausaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="ACCIONES DE MEJORAMIENTO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.acciones}" id="accionesT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="DESCRIPCIÓN ACCIONES" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.descripcion_acciones}" id="descripcion_accionesT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="CÓD. CAUSA PROBABLE" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.codCausaProbable}" id="codCausaProbableT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="TÉRMINO" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.terminoCausa}" id="terminoCausaT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <p:column headerText="DESCRIPCIÓN CAUSA" styleClass="estilo_encabezadotablaes">
                                    <h:outputText value="#{filaReporte.descripcionCausaProb}" id="descripcionCausaProbT" styleClass="estilo_tablaresumen"/>
                                </p:column>
                                <!--  ********************************************************* -->
                                <!--  ********************************************************* -->
                                <!--  ********************************************************* -->
                            </p:dataTable>                            
                <p:separator/>
                <p:panel id="panelExportacion" header="Exporte los resultados a los siguientes formatos" style="width:4200px">
                    <center>
                        <h:commandLink>
                            <p:graphicImage value="/resources/images/excel.png" style="border:none;" id="expExcel"/>
                            <p:dataExporter type="xls" target="datosReporte" fileName="ReportesEventoAdverso" pageOnly="false"/>
                        </h:commandLink>
                        &nbsp;&nbsp;&nbsp;
                        <h:commandLink>
                            <p:graphicImage value="/resources/images/csv.png" style="border:none;" id="expCSV"/>
                            <p:dataExporter type="csv" target="datosReporte" fileName="ReportesEventoAdverso" pageOnly="false" />
                        </h:commandLink>
                        &nbsp;&nbsp;&nbsp;
                        <h:commandLink>
                            <p:graphicImage value="/resources/images/xml.png" style="border:none;" id="expXML"/>
                            <p:dataExporter type="xml" target="datosReporte" fileName="ReportesEventoAdverso" pageOnly="false" />
                        </h:commandLink>                
                    </center>
                </p:panel>
            <br/>
            <br/>
                    <h:commandLink action="/faces/Principal.xhtml" id="inicio">
                            <p:graphicImage value="/resources/images/home.png"/>
                            <h:outputText value="Regresar a la Pantalla Principal" styleClass="enlaceRetorno"/>
                    </h:commandLink>
            </center>
            <!-- ******************************************************** -->
            <!-- ******************************************************** -->
            <!-- ******************************************************** -->
            <!-- ******************************************************** -->
            </h:form>
        </div>
    </ui:define>
</ui:composition>
